name: 'Aqua Security Tracee Create PR'
description: 'Creates a PR depending on if profile differences are found'
author: 'Aqua Security'
inputs:
  workdir:
    description: "Working directory for Tracee"
    required: true
    default: "/tmp/tracee"

runs:
  using: 'composite'
  steps:
  - shell: bash
    run: |
      cp ${{ inputs.workdir }}/out/tracee.profile .
      git config --global user.email "opensource@aquasec.com"
      git config --global user.name "Tracee Bot"
      git checkout -B 'tracee-profile-update'
      git add tracee.profile
      git commit -m 'update tracee.profile'
      git push -f --set-upstream origin tracee-profile-update
#      gh auth login --with-token <<<'${{ secrets.GITHUB_TOKEN }}'
      compareURL='${{ github.event.compare }}'
      bodyMessage="Changes introduced with changes:${compareURL} Powered by Tracee"
      gh pr create --title "Updates to tracee.profile" --body "${bodyMessage}"